<html>  <meta charset="utf-8"><script src='../scripts/jquery.min.js'> </script><script src='../scripts/base64.js'> </script><script src='../scripts/params.js'> </script><script src='../scripts/post.js'> </script><script src='../scripts/nanoclient.js'> </script><script src='../scripts/on_add.js'> </script> <!-- Bitmessage - retranslation --><body>    Select file with cached json "temp"-folder): <input type="file"  id="tekstfile"><br>	partial splitted JSON, after loading this:<div id="fileContents" title="This may seems like clear JSON, after loading the file with posts in JSON." style="display: inline-block;"></div>    		<br>	<br>	Also, see console.log (F12 button)...</body><script>var current_api 	= 	'http://127.0.0.1:7346/api/';	//where need to download posts from remote apivar remote_api 		= 	'http://127.0.0.1:7347/api/';	//from where need to download posts, and where need to upload posts.function IsJsonString(str) {	//test is valid JSON or not    try {							//try        JSON.parse(str);				//parse this as JSON    } catch (e) {					//if error		//console.log('parse error..', e);        return false;					//return false, JSON is invalid.    }								//else    return true;						//return true, JSON is valid.}document.getElementById('tekstfile').onchange = function() {	console.log("File loading... Wait...")  	document.getElementById("fileContents").textContent = ""; 	var file = this.files[0]; 	var reader = new FileReader(); 	reader.onload = function(progressEvent) {		var splitted_JSON = (this.result).split('[{"hash":"');				var clear_JSON_from_cached_POST_request = "";				if(splitted_JSON.length == 2){						//if one request cached (header + '[{"hash":"' + blahblah_JSON + '"}]')			clear_JSON_from_cached_POST_request = '[{"hash":"' + (splitted_JSON[1].split(']')[0]) + ']';				//then just return this.		}else if(splitted_JSON.length >= 2){				//else if many POST-request was been cached in one file			for(var i = 1; i<splitted_JSON.length; i++){		//for each splitted block				clear_JSON_from_cached_POST_request +=			//add to result string the following data:					(						(i==1)									//for first block							?	'['									//add '['							:	''									//else don't add					)					+'{"hash":"'									//add this, because split by this					+splitted_JSON[i].split('"}]')[0]				//add the JSON-block of POST-request, without end of this block, and the header of next request					+(						(typeof splitted_JSON[i+1] !== 'undefined')	//if there is some another items in splitted array							? '"},'										//then add this							: '"}]'										//or this and in the end, when no any items, and next item have typeof 'undefined';					)				;			}		}else{	//else, try to extract posts from damaged JSON, if request in the cache file was been writted with errors.			splitted_JSON = (this.result).split('"},{"hash":"');	//just split posts by this marker, in splitted_JSON-array			if(splitted_JSON.length > 2){							//if splitted_JSON-array length more than 2				for(var i = 1; i<splitted_JSON.length-1; i++){		//then for each item, excluding 0					var append_JSON = (									//do this							(i==1)											//for first block								?	'['											//add '['								:	''											//else don't add it						)						+'{"hash":"'											//add this, because data was been splitted by this						+ splitted_JSON[i].split('"}]')[0]						//add the item from splitted_JSON-array, after split						+(							(typeof splitted_JSON[i+2] !== 'undefined')			//if there, in splitted_JSON-array, is some another items, excluding last block, 								? '"},'												//then add this								: '"}]'												//or skip last item, and add this in the end, when no any items, and next-next item have typeof 'undefined';						)					;	//now string must to be ('[' for 1-st block or '') + '{"hash":"' + blahblah + ('},' or '"}]' for last block);					//console.log("append_JSON", append_JSON.substring(((i==1)?1:0),(append_JSON.length-1)));	//show one post in JSON, after substring					if (IsJsonString(append_JSON.substring(((i==1)?1:0),(append_JSON.length-1)))){	//and if this is really json-string, and not contains the header inside, and this was been parsed...						clear_JSON_from_cached_POST_request += append_JSON;			//append it					}//else, continue				}//up to all items in splitted_JSON-array			}//else do nothing, because 2 parts can be damaged, and corrupted.		}		//now string must to have format '['		+		'{"hash":"' + blahblah_JSON + '"}, ...etc.etc... ,{"hash":"' + blahblah_JSON + '"}' 			+ ']'		//after this, generate partial JSON to show it:		var partial_JSON = clear_JSON_from_cached_POST_request.substring(0, 50)+"    ...    "+clear_JSON_from_cached_POST_request.substring(clear_JSON_from_cached_POST_request.length-50);				//this may seems like JSON. Just need to show it...		console.log("loading... done!");										//show this in console		document.getElementById("fileContents").textContent = partial_JSON;		//add it to div		//And try to send it to remote-server, to do uploading posts there.		//uploading, using on_add.js (XHR POST-query, like in retranslate function)		console.log("Try to send: "+partial_JSON+", to "+remote_api+", wait... ");		_instantRetranslation_copy = _instantRetranslation;			//copy state of this		_instantRetranslation = 'true';								//set it as 'true' permanently		httpPost(remote_api+'upload-posts/', clear_JSON_from_cached_POST_request);		//response not showing, because CORS... Access-Control-Origin for domain 7347, not for 7346//		httpPost(current_api+'upload-posts/', clear_JSON_from_cached_POST_request);		//test request on the current API		_instantRetranslation = _instantRetranslation_copy;			//turn back previous state		console.log("Request sent! See status of this request, in the network connections, and response there.");		//show this. 	}//do this all, when file loaded 	reader.readAsText(file);		//run loading the selected file. }</script></html>